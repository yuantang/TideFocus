# ç‰ˆæœ¬ç®¡ç†è¯´æ˜

## ğŸ¯ è‡ªåŠ¨ç‰ˆæœ¬æ›´æ–°æœºåˆ¶

TideFocus å·²å®ç°å®Œå…¨è‡ªåŠ¨åŒ–çš„ç‰ˆæœ¬å·ç®¡ç†ç³»ç»Ÿï¼Œç¡®ä¿æ¯æ¬¡æ„å»ºéƒ½èƒ½æ­£ç¡®æ›´æ–°ç‰ˆæœ¬å·ã€‚

---

## ğŸ“¦ ç‰ˆæœ¬å·è§„åˆ™

æˆ‘ä»¬éµå¾ª [è¯­ä¹‰åŒ–ç‰ˆæœ¬](https://semver.org/lang/zh-CN/) è§„èŒƒï¼š

```
ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å· (MAJOR.MINOR.PATCH)

ä¾‹å¦‚ï¼š1.0.5
- 1: ä¸»ç‰ˆæœ¬å·ï¼ˆé‡å¤§å˜æ›´ï¼‰
- 0: æ¬¡ç‰ˆæœ¬å·ï¼ˆæ–°åŠŸèƒ½ï¼‰
- 5: ä¿®è®¢å·ï¼ˆBug ä¿®å¤ï¼‰
```

### ä½•æ—¶æ›´æ–°ç‰ˆæœ¬å·ï¼Ÿ

- **ä¿®è®¢å·ï¼ˆPatchï¼‰**: Bug ä¿®å¤ã€å°ä¼˜åŒ–ã€æ–‡æ¡ˆè°ƒæ•´
- **æ¬¡ç‰ˆæœ¬å·ï¼ˆMinorï¼‰**: æ–°å¢åŠŸèƒ½ã€åŠŸèƒ½å¢å¼º
- **ä¸»ç‰ˆæœ¬å·ï¼ˆMajorï¼‰**: é‡å¤§æ¶æ„å˜æ›´ã€ä¸å…¼å®¹çš„ API å˜æ›´

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1ï¼šè‡ªåŠ¨æ›´æ–°ï¼ˆæ¨èï¼‰â­

æ¯æ¬¡è¿è¡Œ `npm run build` æ—¶ï¼Œç‰ˆæœ¬å·ä¼š**è‡ªåŠ¨é€’å¢**ï¼ˆè¡¥ä¸ç‰ˆæœ¬ +1ï¼‰ï¼š

```bash
npm run build
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
ğŸ“¦ æ›´æ–°ç‰ˆæœ¬å·: 1.0.4 -> 1.0.5
âœ… å·²æ›´æ–° package.json
âœ… å·²æ›´æ–° public/sw.js
âœ… å·²æ›´æ–° utils/versionCheck.ts
âœ… å·²æ›´æ–° i18n.ts

ğŸ‰ ç‰ˆæœ¬å·æ›´æ–°å®Œæˆï¼æ–°ç‰ˆæœ¬: v1.0.5
```

### æ–¹æ³• 2ï¼šæ‰‹åŠ¨æŒ‡å®šç‰ˆæœ¬ç±»å‹

å¦‚æœéœ€è¦æ›´æ–°æ¬¡ç‰ˆæœ¬å·æˆ–ä¸»ç‰ˆæœ¬å·ï¼š

```bash
# è¡¥ä¸ç‰ˆæœ¬ +1 (1.0.5 -> 1.0.6)
npm run version:patch

# æ¬¡ç‰ˆæœ¬ +1 (1.0.5 -> 1.1.0)
npm run version:minor

# ä¸»ç‰ˆæœ¬ +1 (1.0.5 -> 2.0.0)
npm run version:major
```

---

## ğŸ“ è‡ªåŠ¨æ›´æ–°çš„æ–‡ä»¶

ç‰ˆæœ¬å·ä¼šè‡ªåŠ¨åŒæ­¥æ›´æ–°åˆ°ä»¥ä¸‹æ–‡ä»¶ï¼š

### 1. **package.json**
```json
{
  "version": "1.0.5"
}
```

### 2. **public/sw.js** (Service Worker)
```javascript
const CACHE_NAME = 'tidefocus-v1.0.5';
const RUNTIME_CACHE = 'tidefocus-runtime-v1.0.5';
```

### 3. **utils/versionCheck.ts**
```typescript
const APP_VERSION = '1.0.5';
```

### 4. **i18n.ts** (æ‰€æœ‰è¯­è¨€)
```typescript
// ç®€ä½“ä¸­æ–‡
versionNumber: 'v1.0.5',

// ç¹ä½“ä¸­æ–‡
versionNumber: 'v1.0.5',

// English
versionNumber: 'v1.0.5',

// EspaÃ±ol
versionNumber: 'v1.0.5',

// æ—¥æœ¬èª
versionNumber: 'v1.0.5',

// í•œêµ­ì–´
versionNumber: 'v1.0.5',
```

---

## ğŸ” ç‰ˆæœ¬å·æ˜¾ç¤ºä½ç½®

ç”¨æˆ·å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®çœ‹åˆ°å½“å‰ç‰ˆæœ¬å·ï¼š

1. **å…³äºé¡µé¢** - ç‚¹å‡»å³ä¸Šè§’ä¿¡æ¯æŒ‰é’®ï¼ˆâ„¹ï¸ï¼‰
2. **æµè§ˆå™¨æ§åˆ¶å°** - åº”ç”¨å¯åŠ¨æ—¶ä¼šè¾“å‡ºç‰ˆæœ¬ä¿¡æ¯
3. **Service Worker** - ç¼“å­˜åç§°åŒ…å«ç‰ˆæœ¬å·

---

## ğŸ› ï¸ å·¥ä½œåŸç†

### æ„å»ºæµç¨‹

```
npm run build
    â†“
1. æ‰§è¡Œ prebuild hook
    â†“
2. è¿è¡Œ scripts/update-version.js
    â†“
3. è¯»å– package.json å½“å‰ç‰ˆæœ¬
    â†“
4. è®¡ç®—æ–°ç‰ˆæœ¬å·ï¼ˆ+1ï¼‰
    â†“
5. æ›´æ–°æ‰€æœ‰æ–‡ä»¶ä¸­çš„ç‰ˆæœ¬å·
    â†“
6. æ‰§è¡Œ vite build
    â†“
7. ç”Ÿæˆå¸¦æ–°ç‰ˆæœ¬å·çš„æ„å»ºæ–‡ä»¶
```

### ç‰ˆæœ¬æ£€æµ‹æœºåˆ¶

åº”ç”¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ£€æµ‹ç‰ˆæœ¬æ›´æ–°ï¼š

```typescript
// utils/versionCheck.ts
export const initVersionCheck = async () => {
  const storedVersion = localStorage.getItem('app_version');
  const currentVersion = APP_VERSION;
  
  if (storedVersion !== currentVersion) {
    // ç‰ˆæœ¬å·²æ›´æ–°ï¼Œæ¸…é™¤ç¼“å­˜
    await clearAllCaches();
    localStorage.setItem('app_version', currentVersion);
    window.location.reload();
  }
};
```

---

## ğŸ“Š ç‰ˆæœ¬å†å²

æŸ¥çœ‹å®Œæ•´çš„ç‰ˆæœ¬å†å²ï¼š

```bash
git log --oneline --grep="version"
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ä¸è¦æ‰‹åŠ¨ä¿®æ”¹ç‰ˆæœ¬å·

æ‰€æœ‰ç‰ˆæœ¬å·éƒ½ç”±è„šæœ¬è‡ªåŠ¨ç®¡ç†ï¼Œ**ä¸è¦æ‰‹åŠ¨ä¿®æ”¹**ä»¥ä¸‹æ–‡ä»¶ä¸­çš„ç‰ˆæœ¬å·ï¼š
- âŒ package.json
- âŒ public/sw.js
- âŒ utils/versionCheck.ts
- âŒ i18n.ts

### 2. æ„å»ºå‰ç¡®ä¿ä»£ç å·²æäº¤

å»ºè®®åœ¨æ„å»ºå‰æäº¤æ‰€æœ‰ä»£ç æ›´æ”¹ï¼š

```bash
git add -A
git commit -m "feat: æ–°åŠŸèƒ½æè¿°"
npm run build
git add -A
git commit -m "chore: bump version to v1.0.x"
git push origin main
```

### 3. ç‰ˆæœ¬å·åªå¢ä¸å‡

ç‰ˆæœ¬å·æ˜¯å•å‘é€’å¢çš„ï¼Œä¸èƒ½å›é€€åˆ°æ—§ç‰ˆæœ¬å·ã€‚

---

## ğŸ‰ ä¼˜åŠ¿

### âœ… è‡ªåŠ¨åŒ–
- æ— éœ€æ‰‹åŠ¨æ›´æ–°å¤šä¸ªæ–‡ä»¶
- é¿å…ç‰ˆæœ¬å·ä¸ä¸€è‡´
- å‡å°‘äººä¸ºé”™è¯¯

### âœ… å¯è¿½æº¯
- æ¯ä¸ªç‰ˆæœ¬éƒ½æœ‰æ˜ç¡®çš„ç‰ˆæœ¬å·
- ç”¨æˆ·å¯ä»¥çœ‹åˆ°å½“å‰ä½¿ç”¨çš„ç‰ˆæœ¬
- æ–¹ä¾¿é—®é¢˜æ’æŸ¥å’Œ Bug è¿½è¸ª

### âœ… ç¼“å­˜ç®¡ç†
- Service Worker ä½¿ç”¨ç‰ˆæœ¬å·ç®¡ç†ç¼“å­˜
- ç‰ˆæœ¬æ›´æ–°æ—¶è‡ªåŠ¨æ¸…é™¤æ—§ç¼“å­˜
- ç¡®ä¿ç”¨æˆ·å§‹ç»ˆä½¿ç”¨æœ€æ–°ç‰ˆæœ¬

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `scripts/update-version.js` - ç‰ˆæœ¬æ›´æ–°è„šæœ¬
- `utils/versionCheck.ts` - ç‰ˆæœ¬æ£€æµ‹å·¥å…·
- `public/sw.js` - Service Workerï¼ˆåŒ…å«ç‰ˆæœ¬å·ï¼‰
- `package.json` - é¡¹ç›®é…ç½®ï¼ˆåŒ…å«ç‰ˆæœ¬å·ï¼‰
- `i18n.ts` - å›½é™…åŒ–é…ç½®ï¼ˆåŒ…å«ç‰ˆæœ¬å·æ˜¾ç¤ºï¼‰

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒ](https://semver.org/lang/zh-CN/)
- [npm version å‘½ä»¤](https://docs.npmjs.com/cli/v8/commands/npm-version)
- [Git æ ‡ç­¾ç®¡ç†](https://git-scm.com/book/zh/v2/Git-%E5%9F%BA%E7%A1%80-%E6%89%93%E6%A0%87%E7%AD%BE)

